<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>{$common.title}</title>
<link href="css/base.css" type="text/css" rel="stylesheet">
<link href="css/details.css" type="text/css" rel="stylesheet">

<script type="text/javascript" src="js/jquery1.42.min.js"></script>
<script type="text/javascript" src="/public/dialog/jquery.artDialog.js?skin=default"></script>
<script type="text/javascript" src="__PUBLIC__/player/js/action.js"></script>
</head>
<body>
 <!--头部-->
<!--#include file="head.html"-->
<link href="__TPL__/new/css/index.css" rel="stylesheet" type="text/css" />
<!--END-->
<!--start 中间部分-->
<div class="volid">
	<div class="contentBox">
   			<img class="big_img" src="/upload/aidimage/{$info.aid}.png"/>
			<h1>
            	<img src="/upload/aidimage/{$info.aid}.png"  style="float:left; height:55px;"/>
            	<p>
                	<span>温馨提示：</span>
                	<br/>
                    鼠标移动到二维码会放大！
                </p>
                {$info.title}
            </h1>
            
            <script>
                	$('.contentBox h1 img').mouseover(function(){
						$('.big_img').show();
					}).mouseout(function(){
						$('.big_img').hide();
					});
           </script>
		<div class="volid_main">
        
          <?php if($info['channeltype']){  ?>
        <object width="100%" id="player" height="400" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000">
<param name="allowFullScreen" value="true">
<param name="allowScriptAccess" value="always" />
<param name="flashVars" value="activityId={$info.activityId}" />
<param name="movie" value="http://sdk.lecloud.com/live.swf" />
<embed src="http://sdk.lecloud.com/live.swf" flashVars="activityId={$info.activityId}" name="player" width="100%" height="400" allowFullScreen="true" type="application/x-shockwave-flash"  allowScriptAccess="always"/>
</object>
        
            <?php }else{  ?>
		 <div id="play" class="play" style="width:100%; height:100%">
        	
        </div>
        </div>
<script type="text/javascript" src="http://cdn.aodianyun.com/lss/aodianplay/player.js"></script>
<script type="text/javascript">

var play=true;
					t1 = {$info.starttime}*1000;
					t = {$info.starttime}*1000 + {$info.time}*60*1000;
					ts = <?php echo time(); ?>*1000;	

				if(ts < t1){
				
					play='false';
		        }else if(ts > t1 && ts < t){
		        play='true';
					
				}else{ 
					 play='false';
					
					
				}	
if(play=='false'){ 
	var objectPlayer=new aodianPlayer({
    container:'play',//播放器容器ID，必要参数
   rtmpUrl:'rtmp://{$sys.ali}{$channel.vMp4url}',//控制台开通的APP rtmp地址，必要参数
  hlsUrl:'http://{$sys.ali}{$channel.vMp4url}.m3u8',//控制台开通的APP rtmp地址，必要参
    /* 以下为可选参数*/
    width: '100%',//播放器宽度，可用数字、百分比等
    height: '400',//播放器高度，可用数字、百分比等
    autostart: false,//是否自动播放，默认为false
    bufferlength: '1',//视频缓冲时间，默认为3秒。hls不支持！手机端不支持
    maxbufferlength: '2',//最大视频缓冲时间，默认为2秒。hls不支持！手机端不支持
    stretching: '1',//设置全屏模式,1代表按比例撑满至全屏,2代表铺满全屏,3代表视频原始大小,默认值为1。hls初始设置不支持，手机端不支持
    controlbardisplay: 'disable',//是否显示控制栏，值为：disable、enable默认为disable。
    //adveDeAddr: '',//封面图片链接
    //adveWidth: 320,//封面图宽度
    //adveHeight: 240,//封面图高度
    //adveReAddr: ''//封面图点击链接
});

	
	}else{
	var objectPlayer=new aodianPlayer({
    container:'play',//播放器容器ID，必要参数
   rtmpUrl:'rtmp://{$sys.ali}{$channel.vMp4url}',//控制台开通的APP rtmp地址，必要参数
  hlsUrl:'http://{$sys.ali}{$channel.vMp4url}.m3u8',//控制台开通的APP rtmp地址，必要参
    /* 以下为可选参数*/
    width: '100%',//播放器宽度，可用数字、百分比等
    height: '400',//播放器高度，可用数字、百分比等
    autostart: true,//是否自动播放，默认为false
    bufferlength: '1',//视频缓冲时间，默认为3秒。hls不支持！手机端不支持
    maxbufferlength: '2',//最大视频缓冲时间，默认为2秒。hls不支持！手机端不支持
    stretching: '1',//设置全屏模式,1代表按比例撑满至全屏,2代表铺满全屏,3代表视频原始大小,默认值为1。hls初始设置不支持，手机端不支持
    controlbardisplay: 'disable',//是否显示控制栏，值为：disable、enable默认为disable。
    //adveDeAddr: '',//封面图片链接
    //adveWidth: 320,//封面图宽度
    //adveHeight: 240,//封面图高度
    //adveReAddr: ''//封面图点击链接
});
	
		
		}


/* rtmpUrl与hlsUrl同时存在时播放器优先加载rtmp*/
/* 以下为Aodian Player支持的事件 */
/* objectPlayer.startPlay();//播放 */
/* objectPlayer.pausePlay();//暂停 */
/* objectPlayer.stopPlay();//停止 hls不支持*/
/* objectPlayer.closeConnect();//断开连接 */
/* objectPlayer.setMute(true);//静音或恢复音量，参数为true|false */
/* objectPlayer.setVolume(volume);//设置音量，参数为0-100数字 */
/* objectPlayer.setFullScreenMode(1);//设置全屏模式,1代表按比例撑满至全屏,2代表铺满全屏,3代表视频原始大小,默认值为1。手机不支持 */
</script>
        
           <?php } ?>
       <div style="background: #fff url('{$info.image}') no-repeat scroll 0 0 / cover ;" class="down <?php 
		 $end = $info['starttime'] + 60*$info['time'];
		 if ($info['starttime'] <= time() && $end >= time()) {
		 	echo 'noe';
		 }
		?>" >
			<div class="doo">
				<div id="dao" class="endtime" value="{$info.starttime}"></div>
			</div>
		</div>  
</div>				 
		
		<div class="volid_bottom">
			<ul>
				<li><a href="javascript:;" onclick="praise()"><i class="blog_icon8"> </i><span id="laud">{$info.laud}</span></a></li>
				<li style="border:none;"><a href="javascript:;" onclick="collection()"><i class="blog_icon9"> </i><span id="collection">加入收藏</span></a></li>
			</ul>
		</div>
	</div>
</div>
<div class="contentBox t100">
    <ul id="mainTabs">
    <!--foreach:{$functions $key $vo}-->
                          
          <li>
    		<a  href="#funcions{$vo.id}" >{$vo.name}</a>	
        </li>	
                           <!--/loop-->
    	
       
    </ul>
    <!--foreach:{$functions $key $vo}-->
    <div id="funcions{$vo.id}">
   
  
                     <?php if($vo['type']=='comment'){?>
                      <div class="bjBox">
        <ul class="bjList clearfix" id="comments_list">
        </ul>
    </div>
	<div class="load_m tr" id="more">加载更多</div>
  
					
                          <?php }elseif($vo['type']=='content'){?>
                        	
    						{$vo.content html}
  
                         <?php }elseif($vo['type']=='url'){?>
                         <script>
						 $('.funcions{$vo.id}').bind('click',function(){
							 
							window.location="{$vo.content}"; 
							 });
						 </script>
                          <?php }elseif($vo['type']=='linkaid'){?>
                          <ul>
     <?php  
     $loop=array();
     if($vo['content'])
    $loop=model('content')->getlist($vo['content']);
  
      ?> <!--foreach:{$loop $val}-->    
                <li   class="<?php echo $val['cid']==16?'live-class':'over-class';  ?>">
                    <a href="{$val.aurl}"><span>●</span>{$val.title len="20"} </a>
                   <span><?php echo $val['cid']==16?'直播':'重播';  ?></span>
				</li>
		<!--/loop-->
		</ul>
                   <?php }elseif($vo['type']=='looktimes'){?>
                          <ul>
     <?php  
     $loop=array();
    $loop=model('content')->gettimes($info['videourl']);
  
      ?> <!--foreach:{$loop $val}-->    
                <li  >
                    <a href="javascript:" onclick="playseek(this)" data-time="{$val.start}"  end-time="{$val.end}">●{$val.name} </a>
                   
				</li>
		<!--/loop-->
		</ul>
                           <?php }?>
					</div>
                           <!--/loop-->
  
</div>
<script type="text/javascript" src="__PUBLIC__/js/jquery.idTabs.min.js"></script>
<script>
	$("#mainTabs").idTabs();
</script>
<div class="contentBox">
	<div class="mborder"></div>
</div>
<div class="contentBox">
	<div class="addAnswerBox">
		<form  id="form">					 
			<p class="comment-form-comment" id="commentform" >
				<textarea id="message" name="message" cols="45" rows="8" reg="\S" msg="评论不能为空" ></textarea>
			</p>
			<p class="form-submit handle2" id="commentform" >
        <input id="fid" name="fid" value="{$info.aid}" type="hidden" />
				<input id="content_" name="type" value="content" type="hidden" />
	      <input name="submit" type="botton" id="submit" class="btn fr" value="立即评论">
			</p>
			<div class="clear"></div>
	  </form>
	</div>
</div>
<!--底部-->
<!--#include file="foot.html"-->
<!--END-->
<script type="text/javascript">
$(function(){
	var t = '<?php echo intval($info[time]);?>'*60;
   timeid=  setInterval(function(){
      $(".endtime").each(function(){
        var obj = $(this);
        var endTime = new Date(parseInt(obj.attr('value')) * 1000);
        var nowTime = new Date();
        var nMS=endTime.getTime() - nowTime.getTime();
        var myD=Math.floor(nMS/(1000 * 60 * 60 * 24));
        var myH=Math.floor(nMS/(1000*60*60)) % 24; //小时 
        var myM=Math.floor(nMS/(1000*60)) % 60; //分钟 
        var myS=Math.floor(nMS/1000) % 60; //秒 
        var myMS=Math.floor(nMS/100) % 10; //拆分秒
		var x=nMS/1000;
		var y = x+t;
        if(nMS>= 0){
            var str = "<span>离直播开始还有<\/span><br>" + myD+"<i>天</i>"+myH+"<i>小时</i>"+myM+"<i>分</i>"+myS+"<i>秒</i>";
			obj.html(str);
        }else{
			if(y>0){
				if(play=='false'){
		objectPlayer.startPlay();
								}
				$('.down').hide();
			}else{
				if(play=='true'){
		objectPlayer.stopPlay();
								}
				$('.down').show();
				<?php if($info['videourl']){ ?>
				var str = "<a href=\"{$info.aurl}\"><span style=\"color:#f00;\">直播已结束,点此回看<\/span></a>";
					<?php }else{ ?>
				var str = "<span style=\"color:#f00;\">直播已结束<\/span>";  
					<?php }?>
				clearInterval(timeid);
				obj.html(str);
				$('#CuPlayer').html('');
			}
        }
      });
    }, 100);
});

	var data = {
		fid: {$info.aid},
		pageSize: 10,
		pageIndex: 0,
	};
	var arr = {
		fid: {$info.aid},
		id: 0
	};
	var id = 0,
	flag=0;

	//弹窗
	function mydialog(t, c) {
		var d = art.dialog({
		  title: t,
		  content: c,	
		  });
		  d.show();
		  setTimeout(function () {
			d.close();
		}, 1200);
	}

	getcomment();
	
	$("#more").click(function(){
		data['pageIndex']++;
			getcomment();
	});
	
	function getcomment(){
		$.post('__ROOT__/index.php/comment/pc_list',{data: data},function(d){
			if(d.status==1){
				var count = d.message.count;
				var page1 = data['pageSize']*data['pageIndex'];
				var page2 = data['pageSize']*data['pageIndex'] + data['pageSize'];
				if (data['pageIndex'] == 0) {
					if (count > 0) {
						id = d.message.info[0]['id'];
					}
				}
				$('#num').html(count);
				if(d.message.count == 0){
					$("#more").hide();
					$('#jcpl').html('暂无数据');
				}else{
					 if(count > page1 && count <= page2){
						$("#more").hide();
						$('#comments_list').append(escapes(d.message.info));	
					}else{
						$('#comments_list').append(escapes(d.message.info));	
						$("#more").show();
					}
				}
				
			}
		},'json')
	}

	function praise(){
		$.post('__ROOT__/index.php/change',{type:'love',fid:'{$info.aid}',uid:0},function(data){
			if(data.status=='1'){
				var num = $('.volid_bottom span').html();
				num++;
				$('#laud').html(num);
				mydialog('提示', data.message);
			}else{
				mydialog('提示', data.message);
			}
		},'json')
	}
	
	function laud($id,_this){
		var n = $(_this).find('.num').html();
		$.post('__ROOT__/index.php/change/laud',{type:'comment',fid:$id},function(data){
			console.log(data);
			if(data.status==1){
				n++;
				 $(_this).find('.num').html(n);
				mydialog('提示', data.message);
			}else{
				mydialog('提示', data.message);
			}
		},'json')
	}
	
	function collection(){
		$.post('__ROOT__/index.php/change/collection',{fid:'{$info.aid}'},function(data){
			if(data.status=='1'){
				$('#collection').html("已收藏")
				mydialog('提示', data.message);
			}else{
				mydialog('提示', data.message);
			}
		},'json')
	}
	function escapes(data){
		var strVar = "";
		for(var i=0;i<data.length;i++){	
			if(data[i]['status']=='0'){
						continue;
						}
			strVar += "<li class=\"clearfix\">";
			strVar += "<div class=\"txPic left\">";
			strVar += "	<img src=\""+data[i]['pic']+"\">";
			strVar += "<\/div>";
			strVar += "<div class=\"bjListCon\">";
			strVar += "	<p class=\"biaoti\">";
			strVar += ""+data[i]['name']+"";
			strVar += "	<\/p>";
			strVar += "	<p style=\"display:block;float:right;\" class=\"time\">";
			strVar += ""+data[i]['time']+"";
			strVar += "	<\/p>";
			strVar += "	<br>";
			strVar += "	<p class=\"jianjie\">";
			strVar += ""+data[i]['message']+"";
			strVar += "	<\/p>";
			strVar += "	<p class=\"f-detail\">";
			strVar += "		<a style=\"display:inline;width:180px;\" onclick=\"laud("+data[i]['id']+",this)\" href=\"javascript:void(0);\">赞(<i class=\"num\">"+data[i]['praise']+"<\/i>)<\/a><a onclick=\"comment_m("+data[i]['uid']+", "+data[i]['id']+")\" href=\"javascript:void(0);\">回复("+data[i]['num']+")";
			
			if(data[i]['num']>0){
				strVar += "<ul class=\"recomment clearfix\">";
				var res = data[i]['res'];
				for (var j = 0; j < res.length; j++) {
					strVar += "<li class=\"clearfix commentbox\">";
					strVar += "<div class=\"txPic left\">";
					strVar += "<img src=\""+res[j]['pic']+"\" alt=\"\">";
					strVar += "<\/div>";
					strVar += "<div class=\"bjListCon\">";
					strVar += "<p class=\"biaoti\">";
					strVar += ""+res[j]['nickname']+"回复"+res[j]['rid']+"";
					strVar += "<\/p>";
					strVar += "<p style=\"display:block;float:right;\" class=\"time\">";
					strVar += ""+res[j]['time']+"";
					strVar += "<\/p>";
					strVar += "<br>";
					strVar += "<p class=\"jianjie\">";
					strVar += ""+res[j]['message']+"";
					strVar += "<\/p>";
					strVar += "<\/div>";
					strVar += "<\/li>";
					if(res[j]['com'] && res[j]['com'].length > 0){
						for (var g = 0; g < res[j]['com'].length; g++) {
							strVar += "<li style=\"padding-left:30px\" class=\"clearfix commentbox\">";
							strVar += "<div class=\"txPic left\">";
							strVar += "<img src=\""+res[j]['com'][g]['pic']+"\" alt=\"\">";
							strVar += "<\/div>";
							strVar += "<div class=\"bjListCon\">";
							strVar += "<p class=\"biaoti\">";
							strVar += ""+res[j]['com'][g]['nickname']+"回复"+res[j]['com'][g]['rid']+"";
							strVar += "<\/p>";
							strVar += "<p style=\"display:block;float:right;\" class=\"time\">";
							strVar += ""+res[j]['com'][g]['time']+"";
							strVar += "<\/p>";
							strVar += "<br>";
							strVar += "<p class=\"jianjie\">";
							strVar += ""+res[j]['com'][g]['message']+"";
							strVar += "<\/p>";
							strVar += "<\/div>";
							strVar += "<\/li>";	
						}
					}
					
				}
				
				if(data[i]['num']>10){
					strVar += "			<li class=\"more\"><a href=\"#\" id=\"morecomment\">加载更多<\/a><a id=\"talkword\" onclick=\"comment_m("+data[i]['uid']+", "+data[i]['id']+")\" href=\"javascript:void(0);\">   <\/a><\/li>";
				}else{
					strVar += "			<li class=\"more\"><a href=\"javascript:void(0);\" onclick=\"comment_m("+data[i]['uid']+", "+data[i]['id']+")\" id=\"talkword\">&nbsp 我也回复一下&nbsp <\/a><\/li>";
				}
				strVar += "		<\/ul>";
			}
			
			strVar += "		<\/a>";
			strVar += "	<\/p>";
			strVar += "<\/div>";
			strVar += "<\/li>";
		}
		return strVar;
	}

	function comment_m(id, pid){
		var d = art.dialog({
			title: '回复',
			content: '<textarea id="reply" name="reply" cols="45" rows="4" reg="\S" msg="评论不能为空"></textarea>',
			ok: function () {
				var value = $('#reply').val();
				var length_ = value.length;
				if(length_ < 1){
					mydialog('提示', '评论不可小于1个字符');
				}else{
					reply(id, value, pid);
				}
			}
		});
		d.show();
	}

	function reply(id, mesage, pid){
	  $.post("__ROOT__/user/index.php/comment/reply_add",
	  {	
		id:id,
		pid:pid,
		mes:mesage
	  },
	  function(d){
		if(d.status == 1){
			window.location.reload();
		  }else{
			mydialog('提示', '评论需先登录');
		 }
	  },'json');
	}

	$("#submit").click(function(){
		var length_ = $('#message').val().length;
		if (length_<1) {
			var myDialog = art.dialog();
			mydialog('提示', '评论不可小于1个字符');
			return false;
		};
	  $.post("__ROOT__/user/index.php/comment/data",
	  {	
		type:'content',
		fid:$('#fid').val(),
		message:$('#message').val()
	  },
	  function(d){
		if(d.status == 1){
			window.location.reload();
		}else{
			mydialog('提示', '评论需先登录');
		}
	  },'json');   
	});
	if(play==true){
	$(window).scroll(function () {
		if ($(window).scrollTop() >= 690) {  
			 $('#play').addClass('drag');
		}else{
			$('#play').removeClass('drag');
		}
		
		
		if($('#play').hasClass("drag")){
				var $div = $("#play");
			  /* 绑定鼠标左键按住事件 */
			  $div.bind("mousedown",function(event){
				/* 获取需要拖动节点的坐标 */
				var offset_x = $(this)[0].offsetLeft;//x坐标
				var offset_y = $(this)[0].offsetTop;//y坐标
				/* 获取当前鼠标的坐标 */
				var mouse_x = event.pageX;
				var mouse_y = event.pageY;
				/* 绑定拖动事件 */
				/* 由于拖动时，可能鼠标会移出元素，所以应该使用全局（document）元素 */
				$(document).bind("mousemove",function(ev){
				  /* 计算鼠标移动了的位置 */
				  var _x = ev.pageX - mouse_x;
				  var _y = ev.pageY - mouse_y;
				  /* 设置移动后的元素坐标 */
				  var now_x = (offset_x + _x ) + "px";
				  var now_y = (offset_y + _y ) + "px";
				  /* 改变目标元素的位置 */
				  $div.css({
					top:now_y,
					left:now_x
				  	});
					});
			  	});
			  /* 当鼠标左键松开，接触事件绑定 */
			  $(document).bind("mouseup",function(){
				$(this).unbind("mousemove");
			  });  
		  
			  $div.mouseenter( function() { 
				$div.append("<div id='dragto'> 点击按住视频可拖动 </div>");
			  }).mouseleave( function(){
				  $div.find("#dragto").remove();
			  }); 
		 }
	});
	}
</script>
<?php require_once 'cs.php';echo '<img src="'._cnzzTrackPageView(1254194477).'" width="0" height="0"/>';?>
</body>
</html>